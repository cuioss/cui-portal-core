= Portal Authentication API

Comprehensive authentication and authorization framework for Portal applications. This API provides a flexible abstraction layer over various authentication mechanisms, enabling secure user management and access control.

== Maven Coordinates

[source,xml]
----
<dependency>
    <groupId>de.cuioss.portal.authentication</groupId>
    <artifactId>portal-authentication-api</artifactId>
</dependency>
----

== Core Concepts

=== Authentication Model
* link:src/main/java/de/cuioss/portal/authentication/AuthenticatedUserInfo.java[AuthenticatedUserInfo] - Core interface for user identity
* link:src/main/java/de/cuioss/portal/authentication/model/BaseAuthenticatedUserInfo.java[BaseAuthenticatedUserInfo] - Thread-safe implementation
* Immutable user state management
* Extensible attribute system
* Role and group-based authorization

=== Authentication Facade
* link:src/main/java/de/cuioss/portal/authentication/facade/AuthenticationFacade.java[AuthenticationFacade] - Primary authentication interface
* Session lifecycle management
* Pluggable authentication sources
* Secure logout handling

=== User Enrichment
* link:src/main/java/de/cuioss/portal/authentication/PortalUserEnricher.java[PortalUserEnricher] - User data enrichment interface
* Priority-based enrichment chain
* Dynamic context updates
* Custom attribute management

== Detailed Component Documentation

=== AuthenticatedUserInfo Interface
Core interface defining user authentication state:

[source,java]
----
public interface AuthenticatedUserInfo {
    boolean isAuthenticated();
    String getIdentifier();
    String getDisplayName();
    Set<String> getRoles();
    Set<String> getGroups();
    Optional<String> getAttributeValue(String key);
}
----

=== BaseAuthenticatedUserInfo Implementation
Thread-safe implementation with builder pattern:

[source,java]
----
var user = BaseAuthenticatedUserInfo.builder()
    .identifier("user123")
    .displayName("John Doe")
    .authenticated(true)
    .addRole("ADMIN")
    .addGroup("IT_STAFF")
    .addAttribute("department", "IT")
    .build();
----

=== AuthenticationFacade Interface
Primary authentication operations:

[source,java]
----
public interface AuthenticationFacade {
    AuthenticationResult login(HttpServletRequest request, 
                             LoginCredentials credentials);
    void logout(HttpServletRequest request);
    AuthenticatedUserInfo getCurrentUser(HttpServletRequest request);
}
----

== Usage Examples

=== Basic Authentication Flow

[source,java]
----
@Inject
private AuthenticationFacade authFacade;

public void authenticate(HttpServletRequest request, String username, 
                        String password) {
    var credentials = new LoginCredentials(username, password);
    var result = authFacade.login(request, credentials);
    
    if (result.isValid()) {
        var user = result.getUserInfo();
        // Process authenticated user
    }
}
----

=== Role-Based Access Control

[source,java]
----
@Inject
private AuthenticatedUserInfo userInfo;

public void restrictedOperation() {
    if (!userInfo.isAuthenticated()) {
        throw new SecurityException("Authentication required");
    }
    
    if (!userInfo.isUserInRole("ADMIN")) {
        throw new SecurityException("Insufficient privileges");
    }
    
    // Perform restricted operation
}
----

=== Custom User Enrichment

[source,java]
----
@Priority(PortalPriorities.PORTAL_CORE_LEVEL)
public class DepartmentEnricher implements PortalUserEnricher {
    
    @Override
    public AuthenticatedUserInfo enrich(AuthenticatedUserInfo user) {
        return BaseAuthenticatedUserInfo.builder()
            .copyFrom(user)
            .addAttribute("department", loadDepartment(user))
            .build();
    }
}
----

== Configuration

=== Core Properties

[cols="2,2,1"]
|===
|Property |Description |Default

|portal.authentication.enabled
|Enables authentication subsystem
|true

|portal.authentication.session.timeout
|Session timeout in seconds
|3600

|portal.authentication.allowed-roles
|Comma-separated list of valid roles
|USER,ADMIN
|===

=== Security Configuration

[source,properties]
----
# Authentication settings
portal.authentication.enabled=true
portal.authentication.session.timeout=1800

# Role configuration
portal.authentication.allowed-roles=USER,ADMIN,MANAGER
portal.authentication.default-role=USER

# Session management
portal.authentication.session.cookie-name=PORTAL_SESSION
portal.authentication.session.secure-only=true
----

== Best Practices

=== Security Guidelines
* Always validate user input
* Use HTTPS for authentication
* Implement proper session management
* Follow least privilege principle
* Regularly rotate credentials
* Log security events

=== Implementation Guidelines
* Extend BaseAuthenticationFacade for custom authentication
* Use builder pattern for user info creation
* Implement custom UserEnricher for additional attributes
* Handle authentication failures gracefully
* Validate configuration at startup

== Technical Details

=== Thread Safety
* All model classes are immutable
* Facade implementations are thread-safe
* Session handling is concurrent-safe
* Builder pattern ensures safe object creation

=== Performance Considerations
* User info objects are cached per request
* Enrichment chain is optimized
* Role checks use Set implementation
* Attribute access is O(1)

== Related Documentation

* link:../portal-authentication-mock/[Portal Authentication Mock] - Testing support
* link:../portal-authentication-oauth/[Portal Authentication OAuth] - OAuth implementation
* link:https://jakarta.ee/specifications/security/[Jakarta Security]
* link:https://www.rfc-editor.org/rfc/rfc6749[OAuth 2.0 Specification]